#!/bin/bash

unset LD_PRELOAD

query_color() {
    xrdb -query | grep -m 1 "color.$1" | sed -E 's/^.+:\s*#?//g'
}

query_prop() {
    xrdb -query | grep -m 1 "lock.$1" | sed -E 's/^.+:\s*//g'
}

# flush gpg-agent cache
echo RELOADAGENT | gpg-connect-agent

exec i3lock --image="$HOME/.local/share/wallpaper.jpg" --indicator  --force-clock \
    --veriftext="" --wrongtext="" --noinputtext="" --layoutcolor="00000000" --insidevercolor="00000000" --insidewrongcolor="00000000" --insidecolor="00000000" \
    --ringvercolor="$(query_color primary)FF" --ringwrongcolor="$(query_color error)FF" --ringcolor="$(query_color fg-enabled)FF" \
    --keyhlcolor="$(query_color primary)FF" --bshlcolor="$(query_color secondary)FF" \
    --modifpos="w:h" \
    --separatorcolor="00000000" --line-uses-inside \
    --radius=50 --indpos="x+100:h-150" \
    --timecolor="00000000" --time-font="$(query_prop font)" --timecolor="$(query_color fg-enabled)FF" --timesize=72 \
    --time-align=1 --timepos="ix+r+20:iy+50" --timestr="%H:%M" \
    --date-font="$(query_prop font)" --datecolor="$(query_color fg-enabled)FF" --datesize=48 \
    --date-align=1 --datepos="tx:ty-70" --datestr="%A, %b %e"

